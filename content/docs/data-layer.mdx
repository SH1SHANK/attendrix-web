---
title: Data Layer (Firebase)
description: The Attendrix user data architecture, stored in Cloud Firestore.
---

# User Schema

The `users` collection is the source of truth for all student data. Each document key is the Firebase Authentication UID (`users/{uid}`).

<Callout type="warning" title="Firestore Security">
  User documents are **readable** by the owner but **writable only via Server
  Actions**. Client-side writes are disabled via Security Rules to prevent
  gamification fraud.
</Callout>

## Core Properties

<PropertyTable
  columns={[
    { key: "field", header: "Field Name", width: "25%" },
    { key: "type", header: "Type", width: "15%" },
    { key: "description", header: "Description" },
  ]}
  data={[
    {
      field: "uid",
      type: "string",
      description: "Primary Key. Matches Auth UID.",
    },
    { field: "email", type: "string", description: "Institute email address." },
    {
      field: "display_name",
      type: "string",
      description: "Publicly visible name.",
    },
    {
      field: "batchID",
      type: "string",
      description: "Academic batch (e.g., 'ME0204').",
    },
    {
      field: "semesterID",
      type: "string",
      description: "Current active semester ID.",
    },
    {
      field: "amplix",
      type: "number",
      description: "Current Gamification Points (XP).",
    },
    {
      field: "mageRank",
      type: "computed",
      description: "Derived from 'amplix' (see Gamification).",
    },
  ]}
/>

## Complex Objects

### coursesEnrolled

An array of maps containing course-specific attendance data. This is synced from the academic database.

<Snippet language="json" filename="users/{uid}/coursesEnrolled[0]">
  {`{
  "courseID": "MA2013EICB1",
  "courseName": "Mathematics IV",
  "attendedClasses": 10,
  "totalClasses": 14,
  "courseType": {
    "isLab": false,
    "courseType": "core"
  },
  "isEditable": true
}`}
</Snippet>

### challengesAllotted

Tracks the user's progress in active challenges.

<Mermaid
  chart={`
classDiagram
    class User {
        +String uid
        +Int amplix
        +Challenge[] challengesAllotted
    }
    class Challenge {
        +String challengeID
        +String progressID
        +String challengeKey
        +String status
    }
    User "1" --> "*" Challenge : Tracks
`}
/>

<PropertyTable
  columns={[
    { key: "field", header: "Field", width: "30%" },
    { key: "description", header: "Description" },
  ]}
  data={[
    {
      field: "challengeID",
      description: "Reference to the Challenge Template.",
    },
    {
      field: "challengeKey",
      description: "Cycle key (e.g., '0126-W1W' for Week 1 Jan 2026).",
    },
    {
      field: "progressID",
      description: "Unique tracking ID for this user-challenge instance.",
    },
    {
      field: "challengeCondition",
      description: "Logic trigger (e.g., 'attend_full_day').",
    },
  ]}
/>

### Settings Map

User preferences for the application.

<Snippet language="json" filename="users/{uid}/settings">
  {`{
  "notifications": true,
  "googleCalendarSync": false,
  "darkMode": false
}`}
</Snippet>
